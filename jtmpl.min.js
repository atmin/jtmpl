!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.jtmpl=e()}}(function(){var define,module,exports;return function e(n,t,r){function o(i,l){if(!t[i]){if(!n[i]){var c="function"==typeof require&&require;if(!l&&c)return c(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+i+"'")}var d=t[i]={exports:{}};n[i][0].call(d.exports,function(e){var t=n[i][1][e];return o(t?t:e)},d,d.exports,e,n,t,r)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,n){"use strict";function t(e,n,r,o){function a(e,n){if(!e)throw n||"assertion failed"}function i(e,n){for(var t=0,r=Object.getOwnPropertyNames(n),o=r.length;o>t;t++)e[r[t]]=n[r[t]]}function l(e,n){if("object"==typeof e&&null!==e&&"object"==typeof n&&null!==n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var t in e)if(e.hasOwnProperty(t)){if(!n.hasOwnProperty(t))return!1;if(!l(e[t],n[t]))return!1}return!0}return e!==n?!1:!0}function c(){var e=arguments[0],n=["string","number"].indexOf(typeof arguments[1])>-1?arguments[1]:null,t="function"==typeof arguments[1]?arguments[1]:"function"==typeof arguments[2]?arguments[2]:null;a(["change","update","insert","delete"].indexOf(e)>-1),a(["change"].indexOf(e)>-1&&null!==n||["insert","delete","update"].indexOf(e)>-1&&null===n),N[e][n]||(N[e][n]=[]),-1===N[e][n].indexOf(t)&&N[e][n].push(t)}function d(){var e,n=arguments[0],t="string"==typeof arguments[1]?arguments[1]:null,r="function"==typeof arguments[1]?arguments[1]:"function"==typeof arguments[2]?arguments[2]:null;N[n][t]&&(r?(e=N[n][t].indexOf(r),e>-1&&N[n][t].splice(e,1)):N[n][t]=[])}function u(e,n,t){var r,o=N[e][["change"].indexOf(e)>-1?n:null]||[],a=o.length;for(r=0;a>r;r++)o[r].call(C,n,t)}function p(){function n(e){var t,r=Array.isArray(e)?[]:{};for(t in e)"object"==typeof e[t]?r[t]=n(e[t]):"function"!=typeof e[t]&&"_"!==t[0]&&(r[t]=e[t]);return r}return JSON.stringify(n(e))}function s(n){var t;"string"==typeof n&&(n=JSON.parse(n));for(t in n)C(t,n[t]),u("update",t);C.len=e.length}function f(e){l(b[e],h(e,function(){},!0))||u("change",e);for(var n=0,t=x[e]||[],r=t.length;r>n;n++)delete S[t[n]],O[e][n].trigger("update",t[n]);C.parent&&C.parent.trigger("update",C.prop)}function m(e){function t(n){return function(t,r){return n._dependentProps[t]||(n._dependentProps[t]=[],n._dependentContexts[t]=[]),-1===n._dependentProps[t].indexOf(e)&&(n._dependentProps[t].push(e),n._dependentContexts[t].push(C)),n(t,r,!0)}}var o=t(C);return j(o),r&&(o.parent=t(r)),o.root=t(n||C),o}function g(e){var n,t;if(e&&"object"==typeof e){t={};for(n in e)t[n]=e[n]}else t=e;return t}function h(n,t,r){var o=e[n];return"function"==typeof o?(o=o.call(m(n),t),r||(b[n]=void 0===o?o:g(o))):r||(b[n]=o),o}function v(e,r,o){var a=h(e,r,o);return a&&"object"==typeof a?S[e]?S[e]:S[e]=t(a,n||C,C,e):a}function y(n,t){var r=h(n);"function"==typeof e[n]?e[n].call(m(n),t):(e[n]=t,t&&"object"==typeof t&&(delete b[n],delete S[n])),r!==t&&u("update",n)}function _(e,n,t){return(void 0===n||"function"==typeof n?v:y)(e,n,t)}function j(t){function a(n,r){return function(){var o=[][n].apply(e,arguments);return this.len=this.values.length,b={},S={},r.apply(this,arguments),t.parent.trigger("update",t.prop),o}}i(t,{values:e,parent:r||null,root:n||t,prop:void 0===o?null:o,on:c,off:d,trigger:u,toJSON:p,fromJSON:s,_dependentProps:x,_dependentContexts:O}),Array.isArray(e)&&i(t,{len:e.length,pop:a("pop",function(){u("delete",this.len,1)}),push:a("push",function(){u("insert",this.len-1,1)}),reverse:a("reverse",function(){u("delete",0,this.len),u("insert",0,this.len)}),shift:a("shift",function(){u("delete",0,1)}),unshift:a("unshift",function(){u("insert",0,1)}),sort:a("sort",function(){u("delete",0,this.len),u("insert",0,this.len)}),splice:a("splice",function(){arguments[1]&&u("delete",arguments[0],arguments[1]),arguments.length>2&&u("insert",arguments[0],arguments.length-2)})})}var N={change:{},update:{},insert:{},"delete":{}},x={},O={},b={},S={};c("update",f);var C=function(){return _.apply(null,arguments)};return j(C),C}"object"==typeof n&&(n.exports=t)},{}],2:[function(e,n){var t=/^\{\{([\w\.\-]+)\}\}$/;n.exports=[function(e,n){var r=e.getAttribute(n).match(t);return"value"===n&&r?{prop:r[1],rule:function(e,n,t,r){function o(){var o=jtmpl._get(t,r);e[n]!==o&&(e[n]=o||"")}var a=["text","password"].indexOf(e.type)>-1?"keyup":"change";e.addEventListener(a,function(){t(r,e[n])}),t.on("change",r,o),o()}}:void 0},function(e,n){var r=e.getAttribute(n).match(t);return"jtmpl-selected"===n&&r?{prop:r[1],rule:function(e,n,t,r){function o(){if("OPTION"===e.nodeName){var n=selects.indexOf(e.parentNode);if(selectsUpdating[n])return;for(var o=0,a=selectOptions[n].length;a>o;o++)selectOptions[n][o].selected=selectOptionsContexts[n][o](r)}else e.selected=t(r)}"OPTION"===e.nodeName?setTimeout(function(){var n=selects.indexOf(e.parentNode);-1===n&&(n=selects.push(e.parentNode)-1,selectOptions.push([]),selectOptionsContexts.push([]),e.parentNode.addEventListener("change",function(){selectsUpdating[n]=!0;for(var e=0,t=selectOptions[n].length;t>e;e++)selectOptionsContexts[n][e](r,selectOptions[n][e].selected);selectsUpdating[n]=!1})),selectOptions[n].push(e),selectOptionsContexts[n].push(t)},0):e.addEventListener("change",function(){t(r,this.selected)}),t.on("change",r,o),setTimeout(o)}}:void 0},function(e,n){var r=e.getAttribute(n).match(t);return"jtmpl-checked"===n&&r?{prop:r[1],rule:function(e,n,t,r){function o(){if(e.name){if(radioGroupsUpdating[e.name])return;for(var n=0,o=radioGroups[e.name][0].length;o>n;n++)radioGroups[e.name][0][n].checked=radioGroups[e.name][1][n](r)}else e.checked=t(r)}"radio"===e.type&&e.name&&(radioGroups[e.name]||(radioGroups[e.name]=[[],[]]),radioGroups[e.name][0].push(e),radioGroups[e.name][1].push(t)),e.addEventListener("click",function(){if("radio"===e.type&&e.name){radioGroupsUpdating[e.name]=!0;for(var n=0,o=radioGroups[e.name][0].length;o>n;n++)radioGroups[e.name][1][n](r,radioGroups[e.name][0][n].checked);radioGroupsUpdating[e.name]=!1}else t(r,e.checked)}),t.on("change",r,o),setTimeout(o)}}:void 0},function(e,n){var r=e.getAttribute(n).match(t);return r?{prop:r[1],rule:function(e,n,t,r){function o(){var o=jtmpl._get(t,r);return o?e.setAttribute(n,o):e.removeAttribute(n)}t.on("change",r,o),o()}}:void 0},function(e,n){return{prop:e.getAttribute(n),rule:function(e,n,t,r){function o(){e.setAttribute(a,jtmpl.utemplate(r,t,o))}var a=n.replace("jtmpl-","");o()}}}]},{}],3:[function(_dereq_,module,exports){module.exports=[function(e){return e.innerHTML.match(/^[\w\.\-]+$/)?{prop:e.innerHTML,rule:function(e,n,t){var r=document.createTextNode(jtmpl._get(n,t)||"");e.appendChild(r),n.on("change",t,function(){r.data=jtmpl._get(n,t)||""})}}:void 0},function(e){var n=e.innerHTML.match(/^&([\w\.\-]+)$/);return n?{prop:n[1],rule:function(e,n,t){function r(){for(var e,r=document.createDocumentFragment(),i=document.createElement("body");a;)o.parentNode.removeChild(o.previousSibling),a--;for(i.innerHTML=n(t)||"",a=i.childNodes.length,e=0;a>e;e++)r.appendChild(i.childNodes[0]);o.parentNode.insertBefore(r,o)}var o=document.createComment(""),a=0;e.appendChild(o),n.on("change",t,r),r()}}:void 0},function(e){var n=e.innerHTML.match(/>([\w\.\-]+)|'([^\']*)\'|"([^"]*)"/);return n?{prop:n,rule:function(e,n,t){function r(){o||(o=a.parentNode),jtmpl.loader(o,t[1]?n(t[1]):t[2]||t[3],n)}var o,a=document.createComment("");t[1]&&n.on("change",t[1],r),e.appendChild(a),setTimeout(r)}}:void 0},function(node){var match=node.innerHTML.match(/^#([\w\.\-]+)$/);return match?{block:match[1],rule:function(fragment,model,prop,template){function update(i){return function(){for(var parent=anchor.parentNode,anchorIndex=[].indexOf.call(parent.childNodes,anchor),pos=anchorIndex-length+i*chunkSize,size=chunkSize,arr="."===prop?model:model(prop);size--;)parent.removeChild(parent.childNodes[pos]);parent.insertBefore(eval(template+"(arr(i))"),parent.childNodes[pos])}}function insert(index,count){var parent=anchor.parentNode,anchorIndex=[].indexOf.call(parent.childNodes,anchor),pos=anchorIndex-length+index*chunkSize,size=count*chunkSize,i,fragment,arr="."===prop?model:model(prop);for(i=0,fragment=document.createDocumentFragment();count>i;i++)fragment.appendChild(eval(template+"(arr(index + i))"));parent.insertBefore(fragment,parent.childNodes[pos]),length+=size}function del(e,n){var t=anchor.parentNode,r=[].indexOf.call(t.childNodes,anchor),o=r-length+e*chunkSize,a=n*chunkSize;for(length-=a;a--;)t.removeChild(t.childNodes[o])}function change(){for(var val="."===prop?model:model(prop),i,len,render;length;)anchor.parentNode.removeChild(anchor.previousSibling),length--;if("function"==typeof val&&void 0!==val.len){val.on("insert",insert),val.on("delete",del),render=document.createDocumentFragment();var func=eval(template),child,childModel;for(i=0,len=val.values.length;len>i;i++)val.on("change",i,update(i)),childModel=val(i),child=func(childModel),child.__jtmpl__=childModel,render.appendChild(child);length=render.childNodes.length,chunkSize=~~(length/len),anchor.parentNode.insertBefore(render,anchor)}else"function"==typeof val&&void 0===val.len?(render=eval(template+"(val)"),length=render.childNodes.length,chunkSize=length,anchor.parentNode.insertBefore(render,anchor),anchor.parentNode.__jtmpl__=model):val&&(render=eval(template+"(model)"),length=render.childNodes.length,chunkSize=length,anchor.parentNode.insertBefore(render,anchor))}var anchor=document.createComment(""),length=0,chunkSize;fragment.appendChild(anchor),change(),model.on("change",prop,change)}}:void 0},function(node){var match=node.innerHTML.match(/^\^([\w\.\-]+)$/);return match?{block:match[1],rule:function(fragment,model,prop,template){function change(){for(var val="."===prop?model:model(prop),i,len,render;length;)anchor.parentNode.removeChild(anchor.previousSibling),length--;"function"==typeof val&&void 0!==val.len?(val.on("insert",change),val.on("delete",change),render=document.createDocumentFragment(),0===val.len&&render.appendChild(eval(template+"(val(i))")),length=render.childNodes.length,anchor.parentNode.insertBefore(render,anchor)):val||(render=eval(template+"(model)"),length=render.childNodes.length,anchor.parentNode.insertBefore(render,anchor))}var anchor=document.createComment(""),length=0;fragment.appendChild(anchor),change(),model.on("change",prop,change)}}:void 0},function(){return{rule:function(e){e.appendChild(document.createTextNode("REMOVEMELATER"))}}}]},{}],4:[function(e,n){function t(n,o,a){var i,l,c,d,u,p="(function(model) {\nvar frag = document.createDocumentFragment(), node;\n\n";a||(p+="var radioGroups = {};\nvar radioGroupsUpdating = {};\nvar selects = [];\nvar selectsUpdating = [];\nvar selectOptions = [];\nvar selectOptionsContexts = [];\n\n"),p+='model = typeof model === "function" ?model : typeof model === "object" ?jtmpl(model) :jtmpl({".": model});\n\n';for(var s,f=0,m=n.childNodes,g=m.length;g>f;f++)switch(s=m[f],s.nodeType){case 1:if("SCRIPT"===s.nodeName&&"text/jtmpl-tag"===s.type){for(i=0,l=e("./compile-rules-node"),c=l.length;c>i;i++)if(d=l[i](s)){if(d.block){for(u=document.createDocumentFragment(),f++;g>f&&!r(d.block,m[f].innerHTML||"");f++)u.appendChild(m[f].cloneNode(!0));if(f===g)throw"jtmpl: Unclosed "+d.block;p+="("+d.rule.toString()+")(frag, model, "+JSON.stringify(d.block)+", "+JSON.stringify(t(u,o&&o+"-"+s.innerHTML+"["+f+"]",(a||0)+1))+");"}else p+="("+d.rule.toString()+")(frag, model, "+JSON.stringify(d.prop)+");\n";break}}else{p+='node = document.createElement("'+s.nodeName+'");\n';for(var h=0,v=s.attributes,y=v.length;y>h;h++)for(i=0,l=e("./compile-rules-attr"),c=l.length;c>i;i++)if(d=l[i](s,v[h].name.toLowerCase())){p+="("+d.rule.toString()+")(node, "+JSON.stringify(v[h].name)+", model, "+JSON.stringify(d.prop)+");\n";break}"INPUT"!==s.nodeName&&(p+="node.appendChild("+t(s,o&&o+"-"+s.nodeName+"["+f+"]",(a||0)+1)+"(model));\n"),p+="frag.appendChild(node);\n"}break;case 3:p+="frag.appendChild(document.createTextNode("+JSON.stringify(s.data)+"));\n";break;case 8:p+="frag.appendChild(document.createComment("+JSON.stringify(s.data)+"));\n"}return p+="return frag; })",p+=o?"\n//@ sourceURL="+o+"\n//# sourceURL="+o+"\n":""}function r(e,n){var t=n.match(/^\/([\w\.\-]+)?$/);return t?""===e||!t[1]||t[1]===e:!1}n.exports=t},{"./compile-rules-attr":2,"./compile-rules-node":3}],5:[function(_dereq_,module,exports){module.exports=function(target,src,model){function mixin(e,n){for(var t in n)0===t.indexOf("__")&&t.lastIndexOf("__")===t.length-2||"function"==typeof n[t]?void 0===e.values[t]&&(e.values[t]=n[t]):void 0===e(t)&&e(t,n[t])}function applyPlugins(){var e,n;for(e in jtmpl.plugins)plugin=jtmpl.plugins[e],n=model.values["__"+e+"__"],"function"==typeof plugin&&void 0!==n&&plugin.call(model,n,target)}function evalObject(body,src){var result,module={exports:{}};return src=src?"\n//@ sourceURL="+src+"\n//# sourceURL="+src:"",body.match(/^\s*{[\S\s]*}\s*$/)?eval("result="+body+src):(eval(body+src),module.exports)}function loadModel(e,n,t){var r;if(e)if(e.match(jtmpl.RE_NODE_ID)){var o=t.querySelector(e);mixin(model,evalObject(o.innerHTML,e)),applyPlugins(),jtmpl(target,n,model)}else r=e.indexOf("#"),jtmpl("GET",r>-1?e.substring(0,r):e,function(t){var r=e.match(jtmpl.RE_ENDS_WITH_NODE_ID),o=r&&(new DOMParser).parseFromString(t,"text/html").querySelector(r[1]);mixin(model,evalObject(r?o.innerHTML:t,e)),applyPlugins(),jtmpl(target,n,model)});else jtmpl(target,n,model)}function loadTemplate(){var e;if(src)if(src.match(jtmpl.RE_NODE_ID)){var n=document.querySelector(src);loadModel(n.getAttribute("data-model"),n.innerHTML,document)}else e=src.indexOf("#"),jtmpl("GET",e>-1?src.substring(0,e):src,function(e){var n,t,r=src.match(jtmpl.RE_ENDS_WITH_NODE_ID);r?(n=document.createElement("iframe"),n.style.display="none",document.body.appendChild(n),t=n.contentDocument,t.writeln(e),document.body.removeChild(n)):t=document;var o=r&&t.querySelector(r[1]);loadModel(r?o.getAttribute("data-model"):"",r?o.innerHTML:e,t)})}model=model||{},"function"!=typeof model&&(model=jtmpl(model)),loadTemplate()}},{}],6:[function(_dereq_,module,exports){function jtmpl(){var args=[].slice.call(arguments),target,t,template,model;return["GET","POST"].indexOf(args[0])>-1?_dereq_("./xhr").apply(null,args):1===args.length&&"object"==typeof args[0]?_dereq_("freak")(args[0]):1===args.length&&"string"==typeof args[0]?document.querySelector(args[0]).__jtmpl__:void((args[0]&&args[0].nodeType||"string"==typeof args[0])&&(args[1]&&"function"==typeof args[1].appendChild||"string"==typeof args[1])&&void 0!==args[2]&&(target=args[0]&&args[0].nodeType?args[0]:document.querySelector(args[0]),template=args[1].match(jtmpl.RE_NODE_ID)?document.querySelector(args[1]).innerHTML:args[1],model="function"==typeof args[2]?args[2]:jtmpl("object"==typeof args[2]?args[2]:"string"==typeof args[2]&&args[2].match(jtmpl.RE_NODE_ID)?_dereq_("./loader")(document.querySelector(args[2]).innerHTML):{".":args[2]}),"SCRIPT"===target.nodeName&&(t=document.createElement("div"),t.id=target.id,target.parentNode.replaceChild(t,target),target=t),target.__jtmpl__=model,target.innerHTML="",target.appendChild(eval(jtmpl.compile(jtmpl.parse(template),target.getAttribute("data-jtmpl"))+"(model)"))))}window.addEventListener("DOMContentLoaded",function(){for(var e=_dereq_("./loader"),n=document.querySelectorAll("[data-jtmpl]"),t=0,r=n.length;r>t;t++)e(n[t],n[t].getAttribute("data-jtmpl"))}),jtmpl.RE_NODE_ID=/^#[\w\.\-]+$/,jtmpl.RE_ENDS_WITH_NODE_ID=/.+(#[\w\.\-]+)$/,jtmpl.parse=_dereq_("./parse"),jtmpl.compile=_dereq_("./compile"),jtmpl.loader=_dereq_("./loader"),jtmpl.utemplate=_dereq_("./utemplate"),jtmpl._get=function(e,n){var t=e(n);return"function"==typeof t?JSON.stringify(t.values):t},jtmpl.plugins=_dereq_("./plugins"),module.exports=jtmpl},{"./compile":4,"./loader":5,"./parse":7,"./plugins":8,"./utemplate":12,"./xhr":13,freak:1}],7:[function(e,n){function t(e){function n(e){return e=e.replace(/\{\{\{([\S\s]*?)\}\}\}/g,"{{&$1}}"),e=e.replace(/\{\{([\S\s]*?)\}\}/g,function(n,t,r){var o=e.slice(0,r),a=!!o.match(/<[\w\-]+[^>]*?$/),i=o.match(/<(script|SCRIPT)/g),l=o.match(/<\/(script|SCRIPT)/g),c=(i&&i.length||0)>(l&&l.length||0),d=!!o.match(/<!--\s*$/),u=0===t.indexOf("!");return a||d?u?"":n:c?n:'<script type="text/jtmpl-tag">'+t.trim()+"</script>"}),e=e.replace(/(<(?:option|OPTION)[^>]*?)(?:selected|SELECTED)=/g,"$1jtmpl-selected="),e=e.replace(/(<(?:input|INPUT)[^>]*?)(?:checked|CHECKED)=/g,"$1jtmpl-checked=")}var t,r;return e=n(e),t=document.createElement("iframe"),t.style.display="none",document.body.appendChild(t),t.contentDocument.writeln("<!doctype html>\n<html><body>"+e+"</body></html>"),r=t.contentDocument.body,document.body.removeChild(t),r}n.exports=t},{}],8:[function(e,n){n.exports={init:e("./plugins/init"),on:e("./plugins/on"),routes:e("./plugins/routes")}},{"./plugins/init":9,"./plugins/on":10,"./plugins/routes":11}],9:[function(e,n){n.exports=function(e){if("function"==typeof e){var n=this;setTimeout(function(){e.call(n)})}}},{}],10:[function(e,n){n.exports=function(e,n){function t(t){n.addEventListener(t,function(n){for(var r in e[t])if(n.target.matches(r)){for(var o=n.target;!o.__jtmpl__&&o.parentNode;)o=o.parentNode;e[t][r].call(o.__jtmpl__,n)}})}for(var r in e)t(r)}},{}],11:[function(e,n){n.exports=function(){}},{}],12:[function(e,n){function t(e,n,r){return e.replace(/\{\{#([\w\.\-]+)\}\}(.+?)\{\{\/([\w\.\-]*?)\}\}/g,function(e,o,a,i){if(""!==i&&i!==o)throw"jtmpl: Unclosed "+o;"function"==typeof r&&n.on("change",o,r);var l="."===o?n:n(o);return"function"==typeof l&&void 0!==l.len?l.len>0?l.values.map(function(e,n){return t(a.replace(/\{\{\.\}\}/g,"{{"+n+"}}"),l,r)}).join(""):"":"function"==typeof l&&void 0===l.len?t(a,l,r):l?t(a,n,r):""}).replace(/\{\{\^([\w\.\-]+)\}\}(.+?)\{\{\/([\w\.\-]*?)\}\}/g,function(e,o,a,i){if(""!==i&&i!==o)throw"jtmpl: Unclosed "+o;"function"==typeof r&&n.on("change",o,r);var l="."===o?n:n(o);return"function"==typeof l&&void 0!==l.len?0===l.len?t(a,n,r):"":l?"":t(a,n,r)}).replace(/\{\{([\w\.\-]+)\}\}/g,function(e,t){return"function"==typeof r&&n.on("change",t,r),void 0===n(t)?"":n(t)+""})}n.exports=t},{}],13:[function(e,n){n.exports=function(){var e,n,t,r,o,a=[].slice.call(arguments),i=new XMLHttpRequest,l=a.reduce(function(e,n){return"function"==typeof n?n:e},null),c=a[a.length-1];for("object"!=typeof c&&(c={}),e=0,r=Object.getOwnPropertyNames(c),n=r.length;n>e;e++)t=r[e],i[t]=c[t];o="string"==typeof a[2]?a[2]:"object"==typeof a[2]?Object.keys(a[2]).map(function(e){return e+"="+encodeURIComponent(a[2][e])}).join("&"):"";var d=function(e){var n;if(l){try{n=JSON.parse(this.responseText)}catch(t){n=this.responseText}l.call(this,n,e)}};return i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<300?d.call(this,"done"):console.log("jtmpl XHR error: "+this.responseText))},i.open(a[0],a[1],void 0!==c.async?c.async:!0,c.user,c.password),i.send(o),i}},{}]},{},[6])(6)});