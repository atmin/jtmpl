/*! jtmpl 04-05-2014 */
!function(a){"use strict";function b(){var a=[].slice.call(arguments);return["GET","POST"].indexOf(a[0])>-1?b.xhr(a):"string"==typeof a[0]&&"object"==typeof a[1]&&["object","undefined"].indexOf(typeof a[2])>-1?b.compile.apply(null,a):void 0}function c(){this.objs=[],this.store=[]}function d(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function e(a,b){return RegExp(d(a.delimiters[0])+"("+h+")"+d(a.delimiters[1]),b)}function f(a,c,d,e,f){var g,h,i=b.rules,j=b.rules.length;for(a=a.slice(f.delimiters[0].length,-f.delimiters[1].length),g=0;j>g;g++)if(h=i[g](a,c,d,e,f))return h}var g=/^[\w\.\-]+$/,h="[\\s\\S]*?",i={dependents:{},watchers:{}},j=[["<table>","<jtmpl-table>"],["<table ","<jtmpl-table "],["</table>","</jtmpl-table>"],["<tr>","<jtmpl-tr>"],["<tr ","<jtmpl-tr "],["</tr>","</jtmpl-tr>"],["<td>","<jtmpl-td>"],["<td ","<jtmpl-td "],["</td>","</jtmpl-td>"]];b.hasClass=function(a,b){return new RegExp("(\\s|^)"+b+"(\\s|$)").test(a.className)},b.addClass=function(a,c){b.hasClass(a,c)||(a.className+=(a.className&&" "||"")+c)},b.removeClass=function(a,c){b.hasClass(a,c)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+c+"(\\s|$)"),"").replace(/^\s+|\s+$/g,""))},c.prototype={get:function(a,b){var c=this.objs.indexOf(a);return c>-1?this.store[c]:(this.objs.push(a),this.store.push(b||{}),this.store[this.store.length-1])},release:function(a){var b=this.objs.indexOf(a);b>-1&&(this.objs.splice(b,1),this.store.splice(b,1))}},b.store=new c;b.getsetFactory=function(a,c){function d(e,f,g){var h,j,k=b.store.get(a,i);if(k.dependents[e]||(k.dependents[e]=[]),void 0===f||"function"==typeof f)return-1===k.dependents[e].indexOf(c)&&k.dependents[e].push(c),"function"==typeof a[e]?a[e].call(d,f):a[e];for(g||("function"==typeof a[e]?a[e].call(d,f):a[e]=f),h=0,j=k.dependents[e].length;j>h;h++)d(k.dependents[e][h],void 0,!0);if(k.watchers[e])for(h=0,j=k.watchers[e].length;j>h;h++)k.watchers[e][h].call(d,f)}return d};b.compile=function(a,c,g){var h,i,k,l,m,n,o,p,q,r,s,t,u,v,w=document.createDocumentFragment();for(a instanceof Node?p=a:(j.map(function(b){a=a.replace(new RegExp(d(b[0]),"g"),b[1])}),p=document.createElement("body"),p.innerHTML=a),h=0;h<p.childNodes.length;h++)switch(q=p.childNodes[h],r=q.cloneNode(!1),w.appendChild(r),r.nodeType){case 1:for(i=0,k=r.attributes.length;k>i;i++){for(l=r.attributes[i],m=l.value,n="",o=0,console.log("found attr "+l.name+"="+l.value),s=e(g,"g");t=s.exec(m);)u=f(t[0],r,l.name,c,g),n+=m.slice(o,t.index)+(u?u.replace||"":t[0]),o=s.lastIndex;n+=m.slice(o),n!=m&&(l.value=n)}r.appendChild(b.compile(q,c,g));break;case 3:for(s=e(g);t=r.data.match(s);)v=r.splitText(t.index),r=v.splitText(t[0].length),u=f(v.data,v,null,c,g),u&&(v.data=u.replace||"")}return w},b.watch=function(a,c,d){var e;a&&c&&d&&(e=b.store.get(a,i).watchers,e[c]||(e[c]=[]),-1===e[c].indexOf(d)&&e[c].push(d))},b.rules=[function(a,c,d,e){var f=a.match(g);return"class"===d&&f?(b.watch(e,a,function(d){(!!d&&b.addClass||b.removeClass)(c,a)}),{replace:!!e[a]&&a||""}):void 0},function(a,c,d,e){var f=a.match(g);return f?(d?b.watch(e,a,function(a){return a?c.setAttribute(d,a):c.removeAttribute(d)}):b.watch(e,a,function(a){c.data=a}),{replace:e[a]}):void 0}],"undefined"==typeof module?a.jtmpl=b:exports=module.exports=b}(this);