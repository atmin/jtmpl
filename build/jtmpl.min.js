/*! jtmpl 01-06-2014 */
!function(a){"use strict";function b(){var a=[].slice.call(arguments);return["GET","POST"].indexOf(a[0])>-1?b.xhr(a):"string"==typeof a[0]&&"object"==typeof a[1]&&["object","undefined"].indexOf(typeof a[2])>-1?b.compile.apply(null,a):void 0}function c(){this.objs=[],this.store=[]}function d(a,b){function c(a,b){return void 0===b?d[a]:d[a]=b}var d,e,f={pop:function(){d.pop();b([{type:"delete",name:d.length,object:d}])},push:function(){}};for(e in f)c[e]=f[e];return d=a,c}function e(a){var c,d,f=b.store.get(a,m);if(!f.initialized){f.initialized=!0;for(c in a)a.hasOwnProperty(c)&&"object"==typeof a[c]&&(d=b.store.get(a[c],m),d.parent=a,e(a[c]))}return f}function f(a){return(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function g(a,b){return RegExp(f(a.delimiters[0])+"("+l+")"+f(a.delimiters[1]),b)}function h(a,c,d,e,f){var g,h,i=b.rules,j=b.rules.length;for(a=a.slice(f.delimiters[0].length,-f.delimiters[1].length),g=0;j>g;g++)if(h=i[g](a,c,d,e,f))return h}var j=/^[\w\.\-]+$/,k="([\\w\\.\\-]+)",l="[\\s\\S]*?",m={dependents:{},watchers:{},childContexts:[],initialized:!1},n={delimiters:["{{","}}"]};b.extend=function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=a[b]);return d},b.hasClass=function(a,b){return new RegExp("(\\s|^)"+b+"(\\s|$)").test(a.className)},b.addClass=function(a,c){b.hasClass(a,c)||(a.className+=(a.className&&" "||"")+c)},b.removeClass=function(a,c){b.hasClass(a,c)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+c+"(\\s|$)"),"").replace(/^\s+|\s+$/g,""))},c.prototype={get:function(a,b){var c=this.objs.indexOf(a);return c>-1?this.store[c]:(this.objs.push(a),this.store.push(JSON.parse(JSON.stringify(b||{}))),this.store[this.store.length-1])},release:function(a){var b=this.objs.indexOf(a);b>-1&&(this.objs.splice(b,1),this.store.splice(b,1))}},b.store=new c,b.ObservableArray=d,b.bind=function(a){var c={},d={};Object.defineProperty(a,"__these__",{value:function(e){var f=function(g,h,j){if(c[g]||(c[g]=[]),void 0===h||"function"==typeof h)return e&&-1===c[g].indexOf(e)&&c[g].push(e),result="function"==typeof a[g]?a[g].call(f,h):a[g],"object"==typeof result?(b.bind(result),result.__these__(e)):result;for(j||("function"==typeof a[g]?a[g].call(f,h):a[g]=h),i=0,len=c[g].length;len>i;i++)f(c[g][i],void 0,!0);if(d[g])for(i=0,len=d[g].length;len>i;i++)d[g][i].call(f,h)};return f.root=null,f}})};var o=b.getsetFactory=function(b,c){function d(a,e,g){var h,i,j;if(f.dependents[a]||(f.dependents[a]=[]),void 0===e||"function"==typeof e)return c&&-1===f.dependents[a].indexOf(c)&&f.dependents[a].push(c),j="function"==typeof b[a]?b[a].call(d,e):b[a],"object"==typeof j?o(j):j;for(g||("function"==typeof b[a]?b[a].call(d,e):b[a]=e),h=0,i=f.dependents[a].length;i>h;h++)d(f.dependents[a][h],void 0,!0);if(f.watchers[a])for(h=0,i=f.watchers[a].length;i>h;h++)f.watchers[a][h].call(d,e)}var f=e(b);for(d.parent=f.parent?o(f.parent):null,a=d.parent;a;)d.root=a,a=a.parent;return d};b.wrapTagsInHTMLComments=function(a,b){return a.replace(g(b,"g"),function(b,c,d){var e=a.slice(0,d),f=!!e.match(RegExp("<"+k+"[^>]*?$")),g=!!e.match(/<!--\s*$/);return f||g?b:"<!--"+b+"-->"})},b.compile=function(a,c,d){var e,f,i,j,k,l,m,o,p,q,r,s=document.createDocumentFragment();for(d=d||n,a instanceof Node?l=a:(a=b.wrapTagsInHTMLComments(a,d),l=document.createElement("body"),l.innerHTML=a),e=0;e<l.childNodes.length;e++)switch(m=l.childNodes[e],o=m.cloneNode(!1),s.appendChild(o),o.nodeType){case 1:for(f=0,i=o.attributes.length;i>f;f++)for(j=o.attributes[f],k=j.value,p=g(d,"g");q=p.exec(k);)r=h(q[0],o,j.name,c,d);o.appendChild(b.compile(m,c,d));break;case 8:(q=o.data.match(g(d)))&&(r=h(o.data,q[1],null,c,d),r&&r.replace instanceof Node&&o.parentNode.replaceChild(r.replace,o))}return s},b.watch=function(a,c,d){var e;a&&c&&d&&(e=b.store.get(a,m).watchers,e[c]||(e[c]=[]),-1===e[c].indexOf(d)&&e[c].push(d))},b.rules=[function(a,c,d,e,f){var g=a.match(j),h=function(d){(!!d&&b.addClass||b.removeClass)(c,a)};return"class"===d&&g?(b.watch(e,a,h),b.removeClass(c,f.delimiters[0]+a+f.delimiters[1]),{}):void 0},function(a){var b=a.match(new RegExp("#"+k));return b?(console.log(b),{replace:document.createTextNode("."),block:b[1],callback:function(){}}):void 0},function(a,c,d,e){var f,g;return a.match(j)?d?(f=function(a){return a?c.setAttribute(d,a):c.removeAttribute(d)},b.watch(e,a,f),f(e[a]),{}):(g=document.createTextNode(e[a]||""),b.watch(e,a,function(a){g.data=a}),{replace:g}):void 0}],b.xhr=function(a){var b,c,d,e,f,g=new XMLHttpRequest,h=a.reduce(function(a,b){return"function"==typeof b?b:a},null),i=a[a.length-1];for("object"!=typeof i&&(i={}),b=0,e=Object.getOwnPropertyNames(i),c=e.length;c>b;b++)d=e[b],g[d]=i[d];f="string"==typeof a[2]?a[2]:"object"==typeof a[2]?Object.keys(a[2]).map(function(b){return b+"="+encodeURIComponent(a[2][b])}).join("&"):"",g.onload=function(a){var b;if(h){try{b=JSON.parse(this.responseText)}catch(c){b=this.responseText}h.call(this,b,a)}},g.open(a[0],a[1],void 0!==i.async?i.async:!0,i.user,i.password),g.send(f)},"undefined"==typeof module?a.jtmpl=b:exports=module.exports=b}(this);